<% tabindex_on '#search_field' %>
<div id="venues_index">
<h1><%= t("venues") %></h1>
<div id='venues_search'>
  <h2><%= t("find_a_venue") %></h2>
  <%= form_tag venues_path, :method => 'get' do %>
    <div class='keywords'>
      <%= label_tag :query, t("keywords") %>
      <%= text_field_tag :query, params[:query] %>
    </div>
    <div class='wifi'>
      <%= check_box_tag :wifi, '1', params[:wifi] %>
      <%= label_tag :wifi, t("public_wifi") %>
    </div>

    <div class='submit'>
      <%= submit_tag t("search") %>
    </div>
  <% end %>
</div>

<% if @venues %>
  <div id='venues_search_results'>
    <div id='list_description'>
      <% if @tag %>
        <h2><%= t("showing_venues_with_tag", :count => @venues.size, :tag => @tag).html_safe %></h2>
      <% else -%>
        <h2>
          <% if @venues.size == 0 -%>
            <%= t("sorry_no_venues") %>
          <% else -%>
            <%= t("showing_venues", :count => @venues.size, :all => params[:all]?"all ":"" ) %>
          <% end %>
          <% if params[:query].present? %>
            matching &#8220;<%= params[:query] %>&#8221;
          <% end %>
          <%= t("with_public_wifi") if params[:wifi] %>
        </h2>
      <% end -%>
    </div>

    <ul>
      <% for venue in @venues %>
        <li>
          <%= link_to(venue.title, venue_url(venue)) %>
          <% if venue.has_full_address? %>
            <p class='detail'><%= venue.full_address %></p>
          <% end %>
        </li>
      <% end %>
    </ul>
  </div>
<% else %>
  <div id='venue_portal'>
    <div id='most_active'>
      <h3><%= t("most_active") %></h3>
      <ul>
        <% for venue in @most_active_venues %>
          <li>
            <%= link_to(venue.title, venue_url(venue)) %>
            <p class='detail'><%= venue.events_count %> events</p>
          </li>
        <% end %>
      </ul>
    </div>
    <div id='newest'>
      <h3><%= t("newest") %></h3>
      <ul>
        <% for venue in @newest_venues %>
          <li>
            <%= link_to(venue.title, venue_url(venue)) %>
            <p class='detail'><%= t("time_ago", :ago => time_ago_in_words(venue.created_at)) %></p>
          </li>
        <% end %>
      </ul>
    </div>
    <div id="exports">
      <ul>
        <li><%= link_to t("list_all_venues"), venues_path(:all => 1) %></li>
        <li><%= link_to t("view_big_map"), map_venues_path %></li>
      </ul>
      <h3><%= t("export_venues") %></h3>
      <ul>
        <li><%= link_to t("kml"), '/venues.kml' %></li>
        <li><%= link_to t("json"), '/venues.json' %></li>
      </ul>
    </div>
  </div>
  <% end %>
</div>
