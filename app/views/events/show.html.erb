<% tabindex_on '#search_field' %>

<% content_for :discovery_insert do %>
  <link rel="alternate" type="application/x-wiki" title="Edit this page" href="<%= edit_event_url(@event) %>" />
<% end %>

<% content_for :javascript_insert do %>
  <script src="/javascripts/mustache.js" type="text/javascript"></script>
  <script type='text/javascript'>
    $(function() {
      var plan = $('.external.plancast.plan:first');
      if (plan.length > 0) {
        var plan_id = plan.text().split('=')[1];
        $.getJSON("http://api.plancast.com/02/plans/show.json?jsonp=?",
          { extensions: "attendees",
            plan_id: plan_id },
          function(data) {
            if (data.attendees.length > 0) {
              $('.attendees').append(Mustache.to_html($('#attendees-template').html(), data));
            }
          }
        );
      }
    })
  </script>
<% end %>

<a href="#" id="event_sidebar_toggle" class="expander_toggle"><%= t("export_or_edit_event") %></a>

<div id="event_sidebar" class='single_view_right sidebar'>
  <h3 class='first'><%= t("export_to") %></h3>
  <ul>
    <li><%= link_to t("google_calendar"), google_event_export_link(@event), :id => "google_calendar_export", :target => "_blank" %></li>
    <li><%= link_to t("icalendar_file"), "#{event_url(@event)}.ics" %></li>
    <li>
      <%= link_to_function t("hcalendar_markup"), '$("#hcal_field").toggle()' %>
      <div id="hcal_field" style="display: none;">
        <%# TODO: Do we actually want to keep providing this? %>
        <%= text_area_tag 'hCalendar',
          h(
            render :partial => 'hcal.html.erb',
                      :locals => {
                        :event => @event,
                        :show_year => true
                      }
          ), :rows => 10, :cols => 80 %>
      </div>
    </li>
  </ul>
<hr />
  <div id='edit_link'>
    <p>
      <%= t("you_can") %>
      <%= link_to t("edit"), edit_event_url(@event) %>,
      <%= link_to t("clone"), clone_event_url(@event) %>,
      <%= t("or") %>
      <%= link_to t("delete"), event_url(@event), :method => :delete, :confirm => t("are_you_sure") %>
      <%= t("this_event") %>.
    </p>
  </div>
<hr />
  <div id='metadata'>
      <%= datestamp(@event) %>
  </div>
</div>

<%= render :partial => 'events/item', :locals => {:event => @event} %>
